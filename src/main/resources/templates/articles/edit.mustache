{{>layouts/header}}

{{#article}}
    <div class="container">
        <form class="container">
            <input type="hidden" id="article-id" value="{{id}}">

            <div class="mb-3">
                <label class="form-label">제목</label>
                <input type="text" class="form-control" id="title" value="{{title}}">
            </div>
            <div class="mb-3">
                <label class="form-label">내용</label>
                <textarea class="form-control" rows="3" id="content">{{content}}</textarea>
            </div>

            <button type="button" class="btn btn-primary" id="update-btn">Submit</button>
            <a href="/articles/{{id}}">Back</a>
        </form>
    </div>

    <script>
        // 수정 버튼 클릭 이벤트
        const updateButton = document.getElementById('update-btn');

        if (updateButton) {
            updateButton.addEventListener('click', event => {
                // 1. 수정할 데이터 가져오기
                let id = document.getElementById('article-id').value;
                let title = document.getElementById('title').value;
                let content = document.getElementById('content').value;

                // 2. 토큰 꺼내기 (핵심!)
                let token = localStorage.getItem('access_token');

                // 3. API 전송 (PATCH)
                fetch(`/api/articles/${id}`, {
                    method: 'PATCH', // 수정은 PATCH or PUT
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + token // 토큰 탑재
                    },
                    body: JSON.stringify({
                        id: id,
                        title: title,
                        content: content
                    })
                }).then(response => {
                    if (response.ok) {
                        alert('글이 수정되었습니다.');
                        window.location.replace(`/articles/${id}`); // 상세 페이지로 이동
                    } else {
                        alert('수정 실패! (로그인 확인 필요)');
                    }
                });
            });
        }
    </script>
{{/article}}

{{>layouts/footer}}